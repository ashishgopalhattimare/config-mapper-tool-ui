<div>
  <div class="m-3">
    <div class="border rounded-top p-3" fxLayout="row" fxLayout.lt-sm="column">
      <input #fileChooser type="file" accept=".yml" multiple (change)="uploadFiles($event); fileChooser.value=''" style="display: none;"/>
      <app-button [label]="'Choose'" [image]="'add'" (clicked)="fileChooserExecute(fileChooser)"
      [labelCss]="'mr-2'" [buttonCss]="'mr-3'">
      </app-button>
      <app-button [label]="'Clear'" [image]="'close'" (clicked)="clearFiles(); sideNav.close()"
      [labelCss]="'mr-2'" [buttonCss]="'mr-3'">
      </app-button>

      <app-button [label]="'Aggregate'" [image]="'call_merge'" (clicked)="aggregateProfiles()"
      [labelCss]="'ml-2'" [leftIcon]="false" [buttonCss]="'mr-3'">
      </app-button>

      <div class="dropdown mr-3">
        <button class="btn btn-outline-dark dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-expanded="false">
          {{editor}} Merger
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          <button class="dropdown-item" (click)="changeEditor(editorType.name)" *ngFor="let editorType of editorTypeList">
            {{editorType.title}}
          </button>
        </div>
      </div>

      <div class="mr-3 border rounded pl-1 pr-1" fxLayout="column" fxLayoutAlign="start center">
        <div class="form-check">
          <input type="checkbox" style="height: 27px; width: 27px;" (change)="toggleEnableDrag()"
          class="form-check-input" id="dragCheckbox" checked>
          <label class="form-check-label ml-3 mt-1" style="font-size: 16px; font-weight: bold;"
          for="dragCheckbox">
            Enable Drag
          </label>
        </div>
      </div>
    </div>
    <div class="border border-top-0 rounded-bottom p-3">
      <div fxLayout="column" fxLayoutAlign="center center" style="height: 350px" *ngIf="getProfiles().length === 0"
           [@dropAnimation]>
        <img src="assets/missing-profiles.png" style="height: 150px;">
        <div class="mt-2 font-weight-bold" style="font-size: 20px;">
          No Profiles Found
        </div>
      </div>
      <div>
        <div cdkDropList class="custom-list" fxLayout="column" fxLayoutAlign="start stretch" (cdkDropListDropped)="drop($event)">
          <div [@fileAnimation] class="border mb-2 rounded" *ngFor="let profileData of getProfiles(); let i = index">
            <div class="p-2 custom-box" cdkDrag [cdkDragDisabled]="profileData.dragDisabled || !IS_DRAGGABLE">
              <div class="profile-box">
                <div fxLayout="row" fxLayoutAlign="start stretch">
                  <div id="profile-expand-status-{{i}}" style="width:5px" class="mr-2"></div>

                  <div style="width:20px; cursor:pointer" class="mr-2 border border-dark rounded"
                    [style.background]="profileData.color.color">
                  </div>

                  <div fxFlex="row" fxFlex="90" fxLayoutAlign="start center" class="profile-collapse"
                  (click)="updateYAML(profileData.file, 'profile-yaml-' + i, i)"
                  >
                    <div fxFlex="20" fxLayoutAlign="start center">
                      <img src="../../assets/yaml-profile.png" style="height: 45px;">
                    </div>
                    <div fxFlex="60" fxLayoutAlign="start center">{{profileData.file.name}}</div>
                    <div fxFlex="20" fxLayoutAlign="start center" fxHide.lt-sm>
                      {{profileData.file.size/1024 | number: '0.0-2'}} KB
                    </div>
                  </div>

                  <div fxFlex="10" fxLayoutAlign="end center">
                    <app-button [image]="'delete'" [buttonCss]="'square-btn'" [align]="'center center'"
                    (clicked)="removeFile(i, profileData.file, sideNav)"
                    ></app-button>
                  </div>
                </div>
                <div id="profile-expand-{{i}}" class="mt-1 border" #collapse="ngbCollapse" [(ngbCollapse)]="profileData.isCollapsed"
                (mouseleave)="profileData.dragDisabled = false"
                (mouseenter)="profileData.dragDisabled = true">
                  <textarea id="profile-yaml-{{i}}"></textarea>
                </div>
                <code *ngIf="i === getProfileIndex() && getProfileErrorMessage(profileData.file)"
                class="bg-dark text-white rounded mt-2" style="font-size: 12px;"
                fxLayoutAlign="start stretch">
                  {{getProfileErrorMessage(profileData.file)}}
                </code>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <mat-drawer-container>
      <mat-drawer #sideNav mode="side" opened="false" [position]="'end'">
        <div fxLayout="column" fxLayoutAlign="end end" class="mb-5 pr-3 footer">
          <div class="sticky" *ngIf="getAggregatedContent() !== ''">
            <div *ngFor="let profileData of getProfiles(); index as ind" id="side-bar-{{ind}}"
                 style="width: 150px; word-break: break-all"
                 [style.background]="profileData.color.color"
                 class="p-2 mb-2 font-weight-bold rounded-left text-white">
              {{profileData.file.name}}
            </div>
          </div>
        </div>
      </mat-drawer>
      <mat-drawer-content>
        <div fxLayout="row" fxLayoutAlign="start stretch">
          <div class="w-100">
            <div class="footer w-100 mt-3 pr-3 pl-3" fxLayout="row" fxLayoutAlign="start start" *ngIf="getAggregatedContent() !== ''">
              <div class="w-100 border bg-dark text-white hide-scroll" style="height: 40px; overflow-x:auto; overflow-y: hidden">
                <code *ngIf="displayPropertyPathOrFind else findPropertyTemplate" fxLayout="row" fxLayoutAlign="start center"
                     class="pl-2" style="height: 40px">
                  <div class="breadcrumb-box">
                    <span *ngFor="let property of getEditorBreadcrumbArray(); index as ind" class="font-weight-bold find-property text-danger"
                    >{{ind > 0 ? '.' : ''}}<a class="link property-breadcrumb"
                                              (click)="updateEditorCursorPosition(ind)"
                                              style="text-decoration: none; cursor: pointer">{{property}}</a>
                  </span>
                  </div>
                </code>
                <ng-template #findPropertyTemplate>
                  <div class="w-100 find-property">
                    <ng-autocomplete
                      [data]="SUGGESTED_LIST"
                      (selected)="highSuggestedText($event)"
                      (inputChanged)="highSuggestedText($event)"
                      [placeholder]="'Search Property'"
                      [itemTemplate]="suggestItemTemplate">
                    </ng-autocomplete>
                    <ng-template #suggestItemTemplate let-item>
                      <a [innerHTML]="item"></a>
                    </ng-template>
                  </div>
                </ng-template>
              </div>

              <button fxLayoutAlign="center center" class="btn btn-outline-dark ml-1"
                      (click)="toggleDisplayPropertyPathOrFind()"
                      style="height: 40px; width: 40px">
                <span class="material-icons" *ngIf="displayPropertyPathOrFind else cancelFindBtnTemplate">search</span>
                <ng-template #cancelFindBtnTemplate>
                  <span class="material-icons">search_off</span>
                </ng-template>
              </button>
              <button fxLayoutAlign="center center" class="btn btn-outline-dark ml-1"
                      (click)="sideNav.toggle()"
                      style="height: 40px; width: 40px">
                <span class="material-icons">apps</span>
              </button>
            </div>
            <div class="aggregate-display w-100 bg-white mb-4">
              <div class="pt-3" *ngIf="getAggregatedContent() !== ''"></div>
              <div fxLayoutAlign="start stretch" id="display-aggregate" class="border rounded"
                   [hidden]="getAggregatedContent() === ''">
              </div>
            </div>
          </div>
        </div>
      </mat-drawer-content>
    </mat-drawer-container>
  </div>
</div>
